<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google-site-verification" content="ADs615XGlYFeFY5aA_2Ba0TeoFygcw4Oo2L0Y3TeiJw" />
    <title>LIVE DIARY ğŸŠ - ãƒ©ã‚¤ãƒ–å‚æˆ¦å±¥æ­´ãƒ»ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <meta name="description" content="ã€Œã‚ã®ãƒ©ã‚¤ãƒ–ã®ã‚»ãƒˆãƒªã€ãªã‚“ã ã£ã‘ï¼Ÿã€ã‚’ã‚¼ãƒ­ã«ã€‚LIVE DIARYã¯ã€ã‚ãªãŸã®æ¨ã—æ´»ã‚’ã‚¹ãƒãƒ¼ãƒˆã«æ®‹ã™ãƒ©ã‚¤ãƒ–è¨˜éŒ²ã‚¢ãƒ—ãƒªã§ã™ã€‚å‚æˆ¦å±¥æ­´ã‚’ç™»éŒ²ã™ã‚‹ã ã‘ã§ã€ã‚ãªãŸã ã‘ã®éŸ³æ¥½å²ã‚’å¯è¦–åŒ–ã€‚æ€ã„å‡ºã‚’ã€Œãƒ¬ãƒãƒ¼ãƒˆã€ã«ã—ã¦ã‚·ã‚§ã‚¢ã—ã¾ã›ã‚“ã‹ï¼Ÿã‚¹ãƒãƒ›ä¸€ã¤ã§ã€ä¸€ç”Ÿãƒ¢ãƒã®éŸ³æ¥½ä½“é¨“ã‚’ã€‚">
    <meta name="keywords" content="ãƒ©ã‚¤ãƒ–è¨˜éŒ²,ãƒ©ã‚¤ãƒ–å‚æˆ¦å±¥æ­´,LIVEè¨˜éŒ²,ãƒ©ã‚¤ãƒ´ç®¡ç†,ã‚»ãƒˆãƒªç®¡ç†,ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ,ã‚»ãƒˆãƒª,æ¨ã—æ´»,ãƒ©ã‚¤ãƒ–æ—¥è¨˜,ãƒ•ã‚§ã‚¹,ã‚³ãƒ³ã‚µãƒ¼ãƒˆ,é å¾è¨˜éŒ²">
    <meta property="og:title" content="LIVE DIARY ğŸŠ - ãƒã‚¤éŸ³æ¥½å²ã‚’è¨˜éŒ²ã™ã‚‹">
    <meta property="og:description" content="å‚æˆ¦å±¥æ­´ã®ç®¡ç†ã‹ã‚‰ã€æ˜ ãˆã‚‹ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã¾ã§ã€‚ã‚¹ãƒãƒ›ã§å®Œçµã™ã‚‹ãƒ©ã‚¤ãƒ–è¨˜éŒ²ã‚¢ãƒ—ãƒªã€‚">
    <meta property="og:image" content="https://livediary-app.com/image.PNG">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://livediary-app.com/"> <meta name="twitter:card" content="summary_large_image">
      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D4ER0YJSB7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D4ER0YJSB7');
</script>
    <link rel="stylesheet" href="./style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
ã€€ã€€ã€€<style>

    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header class="app-header">
    <div class="confetti" style="left:10%; animation-delay: 0s; background:#ffcc00;"></div>
    <div class="confetti" style="left:30%; animation-delay: 1.5s; background:#ffffff;"></div>
    <div class="confetti" style="left:55%; animation-delay: 0.5s; background:#ff9500;"></div>
    <div class="confetti" style="left:85%; animation-delay: 2.2s; background:#ffffff;"></div>
    
    <div class="header-title">LIVE DIARY</div>
</header>

<main id="app">
    <div id="page-home" class="tab-content active">
        <div class="card">
            <h2>ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæ–°è¦è¿½åŠ </h2> <div class="add-artist-form">
                <input type="text" id="new-artist-name" placeholder="åå‰ã‚’å…¥åŠ›">
                <button onclick="addArtist()" class="btn-add-inline">è¿½åŠ </button>
            </div>
        </div>
            <div class="card">
                <span class="section-title">æ–°ã—ã„ãƒ©ã‚¤ãƒ–ã®ç™»éŒ²</span>
                <select id="live-artist-select"><option value="">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’é¸æŠ</option></select>
                <input type="date" id="live-date"> 
                <input type="text" id="live-name" placeholder="å…¬æ¼”ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰">
                  <input type="text" id="live-venue" list="venue-list" placeholder="ä¼šå ´åã‚’å…¥åŠ›" oninput="autoFillPref()">
                    <datalist id="venue-list"></datalist>
                <select id="live-pref">
                    <option value="">éƒ½é“åºœçœŒã‚’é¸æŠ</option>
                    <option value="åŒ—æµ·é“">åŒ—æµ·é“</option><option value="é’æ£®çœŒ">é’æ£®çœŒ</option><option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option><option value="å®®åŸçœŒ">å®®åŸçœŒ</option><option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option><option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option><option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option><option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option><option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option><option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option><option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option><option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option><option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option><option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option><option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option><option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option><option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option><option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option><option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option><option value="é•·é‡çœŒ">é•·é‡çœŒ</option><option value="å²é˜œçœŒ">å²é˜œçœŒ</option><option value="é™å²¡çœŒ">é™å²¡çœŒ</option><option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option><option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option><option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option><option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option><option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option><option value="å…µåº«çœŒ">å…µåº«çœŒ</option><option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option><option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option><option value="é³¥å–çœŒ">é³¥å–çœŒ</option><option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option><option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option><option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option><option value="å±±å£çœŒ">å±±å£çœŒ</option><option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option><option value="é¦™å·çœŒ">é¦™å·çœŒ</option><option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option><option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option><option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option><option value="ä½è³€çœŒ">ä½è³€çœŒ</option><option value="é•·å´çœŒ">é•·å´çœŒ</option><option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option><option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option><option value="å®®å´çœŒ">å®®å´çœŒ</option><option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option><option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option><option value="æµ·å¤–">æµ·å¤–</option>
                </select>
                <textarea id="live-memo" placeholder="ãƒ¡ãƒ¢ãƒ»æ„Ÿæƒ³" rows="3"></textarea>
                <button onclick="addLive()" class="accent-btn">ãƒ©ã‚¤ãƒ–ã‚’ç™»éŒ²ã™ã‚‹</button>
            </div>
        </div>

        <div id="page-history" class="tab-content"><div id="history-list"></div></div>
        
        
        <div id="page-stats" class="tab-content">
    <div class="card" style="background: linear-gradient(135deg, #FFD700, #FFA500); border: none; margin-bottom: 15px;">
        <button onclick="openShareModal()" style="width: 100%; background: none; border: none; color: #fff; font-weight: 800; font-size: 1.1rem; padding: 10px; cursor: pointer;">
            ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹
        </button>
    </div>

    <div class="card" style="margin-bottom: 15px;">
        <span class="section-title">ğŸ“Š è¡¨ç¤ºå¯¾è±¡</span>
        <select id="stats-filter-artist" onchange="renderStats()" style="margin-bottom:0;">
            <option value="all">ã™ã¹ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</option>
        </select>
    </div>

    <div class="card">
        <div style="max-width: 200px; margin: 0 auto; position: relative;">
            <canvas id="artistChart"></canvas>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -40%); text-align: center;">
                <div style="font-size: 0.75rem; color: #8e8e93; font-weight: bold;" id="stats-total-label">Total</div>
                <div id="total-count-display" style="font-size: 1.8rem; font-weight: bold; color: var(--primary-color);">0</div>
            </div>
        </div>
    </div>

    <div id="stats-artist-ranking"></div>

ã€€ã€€ã€€<div id="stats-artist-search-link" style="margin: 5px 0 15px 0;"></div>

    <div id="stats-song-ranking"></div>

    <div id="stats-yearly-ranking"></div>
    
    <div id="stats-venue-ranking"></div>

    <div class="card" style="padding: 20px; border: 1px solid #f2f2f7;">
        <span class="section-title">ğŸ—º <span id="map-target-name">å…¨å›½</span>é å¾ãƒãƒƒãƒ—</span>
        <div id="japan-map" style="margin: 15px 0;"></div>
        <div style="text-align: center; font-size: 0.85rem; color: #8e8e93; margin-top: 10px; background: #f9f9fb; padding: 8px; border-radius: 8px;">
            åˆ¶è¦‡: <span id="visited-pref-count" style="font-weight:bold; color:var(--primary-color); font-size: 1.1rem;">0</span> <span style="font-size: 0.7rem;">/ 47 éƒ½é“åºœçœŒ</span>
        </div>
    </div>


ã€€ã€€ã€€<div class="card" style="padding: 12px 10px; text-align: center; border: 1px dashed #ccc; background: #fffaf0; margin: -15px 0 15px 0; box-shadow: none; width: 100%; box-sizing: border-box;">
            <p style="font-size: 0.8rem; color: #444; margin: 0 0 8px 0; font-weight: bold; line-height: 1.4;">
                æ¬¡ã¯ã©ã“ã¸é å¾ã™ã‚‹ï¼Ÿ âœˆï¸<br>
            </p>
            <a href="https://hb.afl.rakuten.co.jp/hgc/50ccba3d.194cbdf3.50ccba3e.b1170686/?pc=https%3A%2F%2Ftravel.rakuten.co.jp%2F" 
               target="_blank" rel="noopener noreferrer" 
               style="display: inline-block; background: #bf0000; color: #fff; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.85rem;">
                ğŸ¨ æ¥½å¤©ãƒˆãƒ©ãƒ™ãƒ«ã§å®¿ã‚’æ¢ã™
            </a>
            <div style="font-size: 9px; color: #999; margin-top: 6px;">åºƒå‘Š:å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ç§»å‹•ã—ã¾ã™</div>
        </div>

    <div id="stats-pref-ranking"></div>
</div>


<div id="page-settings" class="tab-content">
    <div class="app-version-info" style="text-align: center; font-size: 12px; color: #8e8e93; margin-bottom: 10px;">Ver 1.0.0</div>

    <div class="settings-card" style="margin-top: 10px !important;">
        <span class="section-title">ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢</span>
        <div class="backup-controls">
            <button onclick="exportData()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
            <button onclick="document.getElementById('import-file').click()">ãƒªã‚¹ãƒˆã‚¢</button>
            <input type="file" id="import-file" style="display:none;" onchange="importData(event)" accept=".json">
        </div>
    </div>

    <div class="card" style="margin-top: 10px; padding: 5px 0;">
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="border-bottom: 1px solid #f2f2f7;">
                <a href="https://note.com/thump_man/n/ncfa806383410" target="_blank" rel="noopener noreferrer" 
                   style="text-decoration: none; color: #333; display: flex; justify-content: space-between; align-items: center; padding: 12px 15px;">
                    <span style="font-size: 0.9rem; font-weight: bold;">ğŸŠ ä½¿ã„æ–¹ (note)</span>
                    <span style="color: #c7c7cc; font-size: 1.1rem;">â€º</span>
                </a>
            </li>
            
            
        <li style="border-bottom: 1px solid #f2f2f7;">
            <div onclick="openTermsModal('terms')" 
               style="cursor: pointer; text-decoration: none; color: #333; display: flex; justify-content: space-between; align-items: center; padding: 12px 15px;">
                <span style="font-size: 0.9rem;">åˆ©ç”¨è¦ç´„</span>
                <span style="color: #c7c7cc; font-size: 1.1rem;">â€º</span>
            </div>
        </li>
        <li>
            <div onclick="openTermsModal('privacy')" 
               style="cursor: pointer; text-decoration: none; color: #333; display: flex; justify-content: space-between; align-items: center; padding: 12px 15px;">
                <span style="font-size: 0.9rem;">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</span>
                <span style="color: #c7c7cc; font-size: 1.1rem;">â€º</span>
            </div>
        </li>
    </ul>
</div>

    <div class="support-container" style="margin: 15px !important; padding: 25px 20px !important; border: 1px solid #ffebcd !important; border-radius: 15px !important; background: #fffaf0 !important; box-sizing: border-box !important; text-align: center !important;">
        <div class="support-content" style="background: transparent !important; border: none !important; padding: 0 !important; margin: 0 !important; box-shadow: none !important;">
            <h3 class="support-title">LIVE DIARYğŸŠã‚’å¿œæ´ã™ã‚‹</h3>
            <p class="support-description">
                LIVE DIARYã¯ã€å€‹äººé–‹ç™ºã®ç„¡æ–™ã‚¢ãƒ—ãƒªã§ã™ã€‚<br>
                ã‚‚ã—ã“ã®ã‚¢ãƒ—ãƒªã‚’æ°—ã«å…¥ã£ã¦ã„ãŸã ã‘ã¾ã—ãŸã‚‰ã€<br>
                OFUSEï¼ˆãƒ•ã‚¡ãƒ³ãƒ¬ã‚¿ãƒ¼ãƒ»æŠ•ã’éŠ­ï¼‰ã‚’ã„ãŸã ã‘ã‚‹ã¨ã€ä»Šå¾Œã®é–‹ç™ºã®å¤§ããªåŠ±ã¿ã«ãªã‚Šã¾ã™ã€‚
            </p>
            <a href="https://ofuse.me/livediary" target="_blank" rel="noopener noreferrer" class="ofuse-btn-b">
                ğŸŠ é–‹ç™ºè€…ã‚’å¿œæ´ã™ã‚‹ï¼ˆOFUSEï¼‰
            </a>
        </div>
    </div>

    <div class="card" style="margin-top: 10px !important;">
        <span class="section-title">ç™»éŒ²ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã®ç®¡ç†</span>
        <input type="text" id="artist-search-input" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã§æ¤œç´¢..." oninput="renderArtistManager()" style="margin-bottom: 10px;">
        <div id="artist-manager-list" style="max-height: 300px; overflow-y: auto; border-top: 1px solid #eee;"></div>
    </div>
    
    <div class="card" style="margin: 10px 10px 30px 10px; padding: 5px 0;">
    <ul style="list-style: none; padding: 0; margin: 0;">
        <li>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSddVxn1OTi7jOeCj566G9bmfaqsM56YxEWFIKtaxvakb2gugw/viewform?usp=header" target="_blank" rel="noopener noreferrer" 
               onclick="return confirm('ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã¸ç§»å‹•ã—ã¾ã™ã€‚\nâ€»å€‹äººé–‹ç™ºã®ãŸã‚ã€åŸå‰‡ã¨ã—ã¦å€‹åˆ¥ã®è¿”ä¿¡ã¯è¡Œã£ã¦ãŠã‚Šã¾ã›ã‚“ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')"
               style="text-decoration: none; color: #333; display: flex; justify-content: space-between; align-items: center; padding: 12px 15px;">
                <span style="font-size: 0.9rem;">âœ‰ï¸ ãŠå•ã„åˆã‚ã›</span>
                <span style="color: #c7c7cc; font-size: 1.1rem;">â€º</span>
            </a>
        </li>
    </ul>
</div>
</div>

    </main>

    <div id="modal-overlay" class="modal-overlay hidden" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-title" style="margin:0; font-size:1rem;">ãƒ©ã‚¤ãƒ–è©³ç´°</h3>
                <button onclick="closeModal()" class="close-btn">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="modal-view">
                    <h2 id="view-live-name" style="color:var(--primary-color); margin-top:0;"></h2>
                    <div id="live-details-info"></div>
                    <div id="setlist-display" style="background:#f9f9fb; padding:15px; border-radius:10px; margin-top:15px;"></div>
                    <button onclick="switchEditMode()" class="primary-btn" style="margin-top:20px;">ç·¨é›†ã™ã‚‹</button>
                </div>
                <div id="modal-edit" class="hidden">
                    <input type="date" id="edit-date">
                    <input type="text" id="edit-name" placeholder="ãƒ©ã‚¤ãƒ–å">
                      <input type="text" id="edit-venue" list="venue-list" placeholder="ä¼šå ´å" oninput="autoFillEditPref()">

                        <select id="edit-pref">
                        <option value="">éƒ½é“åºœçœŒã‚’é¸æŠ</option>
                     <option value="åŒ—æµ·é“">åŒ—æµ·é“</option><option value="é’æ£®çœŒ">é’æ£®çœŒ</option><option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option><option value="å®®åŸçœŒ">å®®åŸçœŒ</option><option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option><option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option><option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option><option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option><option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option><option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option><option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option><option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option><option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option><option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option><option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option><option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option><option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option><option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option><option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option><option value="é•·é‡çœŒ">é•·é‡çœŒ</option><option value="å²é˜œçœŒ">å²é˜œçœŒ</option><option value="é™å²¡çœŒ">é™å²¡çœŒ</option><option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option><option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option><option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option><option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option><option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option><option value="å…µåº«çœŒ">å…µåº«çœŒ</option><option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option><option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option><option value="é³¥å–çœŒ">é³¥å–çœŒ</option><option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option><option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option><option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option><option value="å±±å£çœŒ">å±±å£çœŒ</option><option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option><option value="é¦™å·çœŒ">é¦™å·çœŒ</option><option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option><option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option><option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option><option value="ä½è³€çœŒ">ä½è³€çœŒ</option><option value="é•·å´çœŒ">é•·å´çœŒ</option><option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option><option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option><option value="å®®å´çœŒ">å®®å´çœŒ</option><option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option><option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option><option value="æµ·å¤–">æµ·å¤–</option>
    </select>
                    <textarea id="edit-memo" rows="3" placeholder="ãƒ¡ãƒ¢"></textarea>
                    <textarea id="edit-setlist" rows="5" placeholder="ã‚»ãƒˆãƒªï¼ˆæ”¹è¡ŒåŒºåˆ‡ã‚Šï¼‰"></textarea>
                    
<div style="display: flex; gap: 10px; margin-top: 20px; align-items: center; width: 100%; box-sizing: border-box;">
    
    <button onclick="saveEdit()" class="primary-btn" style="
        flex: 2; 
        height: 42px !important; 
        margin: 0 !important; 
        padding: 0 !important; 
        box-sizing: border-box !important;
        display: flex;
        align-items: center;
        justify-content: center;
    ">ä¿å­˜</button>
    
    <button onclick="deleteLive()" style="
        flex: 1; 
        height: 42px !important; 
        margin: 0 !important; 
        padding: 0 !important; 
        box-sizing: border-box !important;
        background: white; 
        color: red; 
        border: 1px solid red; 
        border-radius: 10px; 
        cursor: pointer; 
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
    ">å‰Šé™¤</button>

</div>
                </div>
            </div>
        </div>
    </div>






<div id="share-modal" class="modal-overlay hidden" onclick="closeShareModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3>ãƒ¬ãƒãƒ¼ãƒˆæ¡ä»¶</h3>
            <button onclick="closeShareModal()" class="close-btn">Ã—</button>
        </div>
        
        <div class="modal-body">
            <span class="section-title">1. é›†è¨ˆæœŸé–“ï¼ˆPeriodï¼‰</span>
            <select id="share-period-type">
                <option value="all">ALL TIMEï¼ˆå…¨æœŸé–“ï¼‰</option>
                </select>
            
            <span class="section-title" style="margin-top:15px;">2. ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆï¼ˆArtistï¼‰</span>
            <select id="share-artist-type">
                <option value="all">ALL Artistsï¼ˆå…¨å¯¾è±¡ï¼‰</option>
                </select>


<span class="section-title" style="margin-top:20px;">3. æ¨ã—è‰²ï¼ˆãƒ†ãƒ¼ãƒï¼‰ã‚’é¸ã¶</span>
<div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px;">
    
    <div style="display: flex; justify-content: space-between; max-width: 210px;">
        <button onclick="setTheme('#af52de')" title="ç´«" style="width:34px; height:34px; background:#af52de; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
        <button onclick="setTheme('#ff3b30')" title="èµ¤" style="width:34px; height:34px; background:#ff3b30; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
        <button onclick="setTheme('#007130')" title="ç·‘" style="width:34px; height:34px; background:#007130; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
        <button onclick="setTheme('#5ac8fa')" title="æ°´è‰²" style="width:34px; height:34px; background:#5ac8fa; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
        <button onclick="setTheme('#34c759')" title="é»„ç·‘" style="width:34px; height:34px; background:#34c759; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
    </div>

    <div style="display: flex; align-items: center; max-width: 275px;">
        <div style="display: flex; gap: 10px; width: 122px;">
            <button onclick="setTheme('#ffb6c1')" title="ãƒ”ãƒ³ã‚¯" style="width:34px; height:34px; background:#ffb6c1; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
            <button onclick="setTheme('#ffcc00')" title="é»„è‰²" style="width:34px; height:34px; background:#ffcc00; border-radius:50%; border:2px solid #fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);"></button>
            <button onclick="setTheme('#ffffff')" title="ç™½" style="width:34px; height:34px; background:#ffffff; border-radius:50%; border:1px solid #c7c7cc; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.1);"></button>
        </div>
        
        <div style="flex-grow: 1;"></div> 

        <div style="height: 30px; border-left: 2px solid #eee; margin-right: 12px;"></div>

        <div style="display:flex; flex-direction:column; align-items:center; width: 40px;">
            <input type="color" id="custom-theme-color" onchange="setTheme(this.value)" style="width:34px; height:34px; padding:0; border:none; background:none; cursor:pointer;">
            <span style="font-size:0.6rem; color:#8e8e93; margin-top: 2px;">è‡ªç”±è‰²</span>
        </div>
    </div>
</div>

            <button onclick="generateReport()" class="accent-btn" style="background: var(--primary-color); height: 50px; font-size: 1.1rem;">ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º</button>
        </div>
    </div>
</div>


<div id="report-preview-overlay" class="modal-overlay hidden" onclick="this.classList.add('hidden')">
    <div id="report-card-container" onclick="event.stopPropagation()"></div>
    
    <div class="report-action-buttons" onclick="event.stopPropagation()" style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
        
        <button onclick="saveReportImage()" class="primary-btn" style="margin-top:20px; width:220px !important;">ç”»åƒã®ä¿å­˜</button>
        
        <button onclick="shareOnX()" style="
            width: 220px !important; 
            height: 48px !important; /* ä¿å­˜ãƒœã‚¿ãƒ³ã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
            background: linear-gradient(180deg, #333 0%, #000 100%) !important; /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¦–èªæ€§UP */
            color: #ffffff !important; 
            border: 1px solid #555 !important; /* æš—ã„èƒŒæ™¯ã§ã‚‚ã‚ã‹ã‚‹æ ç·š */
            border-radius: 25px !important; /* ä¿å­˜ãƒœã‚¿ãƒ³ã¨åŒã˜è§’ä¸¸è¨­å®š */
            display: flex !important; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
            font-weight: bold !important;
            font-size: 16px !important;
            cursor: pointer !important;
            transition: transform 0.1s;
            -webkit-appearance: none;
        ">
            <i class="fab fa-x-twitter"></i> Xã¸æŠ•ç¨¿
        </button>

        <button onclick="document.getElementById('report-preview-overlay').classList.add('hidden')" style="background:none; border:none; color:#ccc; margin-top:10px; text-decoration:underline; font-size:0.9rem; cursor:pointer;">é–‰ã˜ã‚‹</button>
    </div>
</div>


    <nav class="tab-bar">
        <button onclick="showPage('home')" id="tab-home" class="active"><span class="icon">â™¢</span><span>ãƒ›ãƒ¼ãƒ </span></button>
        <button onclick="showPage('history')" id="tab-history"><span class="icon">â–¤</span><span>å±¥æ­´</span></button>
        <button onclick="showPage('stats')" id="tab-stats"><span class="icon">â—‹</span><span>çµ±è¨ˆ</span></button>
        <button onclick="showPage('settings')" id="tab-settings"><span class="icon">âš™</span><span>ç®¡ç†</span></button>
    </nav>

    <script>
    const prefCodes = {
    "åŒ—æµ·é“":"HKD","é’æ£®çœŒ":"AOM","å²©æ‰‹çœŒ":"IWT","å®®åŸçœŒ":"MYG","ç§‹ç”°çœŒ":"AKT","å±±å½¢çœŒ":"YGT","ç¦å³¶çœŒ":"FKS",
    "èŒ¨åŸçœŒ":"IBR","æ ƒæœ¨çœŒ":"TCG","ç¾¤é¦¬çœŒ":"GMA","åŸ¼ç‰çœŒ":"STM","åƒè‘‰çœŒ":"CHB","æ±äº¬éƒ½":"TKY","ç¥å¥ˆå·çœŒ":"KNG",
    "æ–°æ½ŸçœŒ":"NGT","å¯Œå±±çœŒ":"TYM","çŸ³å·çœŒ":"ISK","ç¦äº•çœŒ":"FKI","å±±æ¢¨çœŒ":"YNS","é•·é‡çœŒ":"NGN","å²é˜œçœŒ":"GIF",
    "é™å²¡çœŒ":"SZK","æ„›çŸ¥çœŒ":"AIC","ä¸‰é‡çœŒ":"MIE","æ»‹è³€çœŒ":"SHG","äº¬éƒ½åºœ":"KYT","å¤§é˜ªåºœ":"OSK","å…µåº«çœŒ":"HYG",
    "å¥ˆè‰¯çœŒ":"NRA","å’Œæ­Œå±±çœŒ":"WKY","é³¥å–çœŒ":"TTR","å³¶æ ¹çœŒ":"SMN","å²¡å±±çœŒ":"OKY","åºƒå³¶çœŒ":"HRS","å±±å£çœŒ":"YMG",
    "å¾³å³¶çœŒ":"TKS","é¦™å·çœŒ":"KGW","æ„›åª›çœŒ":"EHM","é«˜çŸ¥çœŒ":"KCH","ç¦å²¡çœŒ":"FUK","ä½è³€çœŒ":"SAG","é•·å´çœŒ":"NGS",
    "ç†Šæœ¬çœŒ":"KMT","å¤§åˆ†çœŒ":"OIT","å®®å´çœŒ":"MZA","é¹¿å…å³¶çœŒ":"KGS","æ²–ç¸„çœŒ":"OKN"
};

        let db = JSON.parse(localStorage.getItem('live_app_db') || '{"artists":[], "lives":[]}');
        let currentId = null; let chart = null;
        const refinedColors = ['#007130', '#34c759', '#30b0c7', '#007aff', '#5856d6', '#ff3b30', '#ff9500'];
        const prefOrder = ["åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ","èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ","æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ","å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ","æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ","é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ","å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ","ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ","æµ·å¤–"];

window.onload = () => { 
    updateArtistSelect(); 
    updateVenueSuggestions(); // â† ã“ã‚Œã‚’è¿½åŠ 
    showPage('home'); 
    document.getElementById('live-date').value = new Date().toISOString().split('T')[0]; 
};

        function save() { localStorage.setItem('live_app_db', JSON.stringify(db)); }

        function showPage(id) {
            document.querySelectorAll('.tab-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
            document.getElementById('tab-'+id).classList.add('active');
            if(id==='history') renderHistory();
            if(id==='stats') renderStats();
            if(id==='settings') renderArtistManager();
        }

        function updateArtistSelect() {
            const s = document.getElementById('live-artist-select');
            s.innerHTML = '<option value="">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’é¸æŠ</option>' + db.artists.sort().map(a=>`<option value="${a}">${a}</option>`).join('');
        }

        function addArtist() {
            const v = document.getElementById('new-artist-name').value.trim();
            if(!v || db.artists.includes(v)) return;
            db.artists.push(v); save(); updateArtistSelect();
            document.getElementById('new-artist-name').value = '';
        }

function updateVenueSuggestions() {
    const venueListElement = document.getElementById('venue-list');
    if (!venueListElement) return;

    // å…¨ã¦ã®ãƒ©ã‚¤ãƒ–å±¥æ­´ã‹ã‚‰ä¼šå ´åã‚’å–å¾—ã—ã€é‡è¤‡ã‚’å‰Šé™¤ã—ã¦ã‚½ãƒ¼ãƒˆ
    const venues = [...new Set(db.lives.map(live => live.venue))]
        .filter(venue => venue && venue.trim() !== "")
        .sort();

    // datalistã®ä¸­èº«ã‚’æ›´æ–°
    venueListElement.innerHTML = venues
        .map(venue => `<option value="${venue}">`)
        .join('');
}

// ä¼šå ´åã‹ã‚‰éƒ½é“åºœçœŒã‚’è‡ªå‹•è£œå®Œã™ã‚‹é–¢æ•°
function autoFillPref() {
    const venueName = document.getElementById('live-venue').value.trim();
    if (!venueName) return;

    // éå»ã®ãƒ©ã‚¤ãƒ–å±¥æ­´ï¼ˆdb.livesï¼‰ã‚’æ–°ã—ã„é †ã«æ¤œç´¢ã—ã€ä¼šå ´åãŒä¸€è‡´ã—ã¦ã€ã‹ã¤éƒ½é“åºœçœŒãŒå…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’æ¢ã™
    const pastLive = [...db.lives].reverse().find(l => l.venue === venueName && l.pref);

    if (pastLive) {
        // ä¸€è‡´ã™ã‚‹ã‚‚ã®ãŒã‚ã‚Œã°ã€éƒ½é“åºœçœŒã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å€¤ã‚’æ›´æ–°
        document.getElementById('live-pref').value = pastLive.pref;
    }
}

function autoFillEditPref() {
    const venueName = document.getElementById('edit-venue').value.trim();
    if (!venueName) return;
    const pastLive = [...db.lives].reverse().find(l => l.venue === venueName && l.pref);
    if (pastLive) {
        document.getElementById('edit-pref').value = pastLive.pref;
    }
}

        function addLive() {
            const art = document.getElementById('live-artist-select').value;
            const day = document.getElementById('live-date').value;
            if(!art || !day) return alert('å…¥åŠ›ä¸è¶³');
            db.lives.push({ id:Date.now(), artist:art, date:day, name:document.getElementById('live-name').value, venue:document.getElementById('live-venue').value, pref:document.getElementById('live-pref').value, memo:document.getElementById('live-memo').value, setlist:[] });
            save();
            updateVenueSuggestions(); // â† ç™»éŒ²å¾Œã«æœ€æ–°ã®ä¼šå ´ã‚’ãƒªã‚¹ãƒˆã«åæ˜ 
                        // --- ã“ã“ã‹ã‚‰å…¥åŠ›ã‚¨ãƒªã‚¢ã®åˆæœŸåŒ–å‡¦ç†ã‚’è¿½åŠ  ---
            document.getElementById('live-artist-select').value = '';
            document.getElementById('live-name').value = '';
            document.getElementById('live-venue').value = '';
            document.getElementById('live-pref').value = '';
            document.getElementById('live-memo').value = '';
            // æ—¥ä»˜ã¯ä»Šæ—¥ã®æ—¥ä»˜ã«æˆ»ã™ï¼ˆãŠå¥½ã¿ã§ï¼‰
            document.getElementById('live-date').value = new Date().toISOString().split('T')[0];
            
            showPage('history');
        }

// --- ã“ã“ã‹ã‚‰å·®ã—æ›¿ãˆ ---
        function renderHistory() {
            const container = document.getElementById('history-list');
            container.innerHTML = '';
            db.artists.sort().forEach(art => {
                const lives = db.lives.filter(l=>l.artist===art).sort((a,b)=>new Date(b.date)-new Date(a.date));
                if(!lives.length) return;
                const card = document.createElement('div');
                card.className = 'card'; card.style.padding = '0';
                card.innerHTML = `<div style="padding:15px; font-weight:bold; cursor:pointer;" onclick="this.nextElementSibling.classList.toggle('hidden')">${art} <span style="float:right; color:var(--primary-color)">${lives.length}å…¬æ¼”</span></div>
                    <div class="hidden" style="border-top:1px solid #eee;">
                    ${lives.map(l=>`
                        <div class="live-history-item" onclick="openDetail(${l.id})" style="padding:14px; border-bottom:1px solid #f2f2f7; cursor:pointer;">
                            <div style="font-size:0.75rem; color:#8e8e93;">${l.date}</div>
                            <div style="font-weight:bold;">${l.name||'(ç„¡é¡Œ)'}</div>
                            <div class="history-venue" style="font-size:0.85rem; color:#666; margin-top:4px;">ğŸ“ ${l.venue || 'ä¼šå ´æœªç™»éŒ²'}</div>
                        </div>`).join('')}
                        
                        <div style="padding:15px; text-align:center; background-color:#f9fbf9;">
                        <a href="https://hb.afl.rakuten.co.jp/hgc/50ccba3d.194cbdf3.50ccba3e.b1170686/?pc=https%3A%2F%2Fsearch.rakuten.co.jp%2Fsearch%2Fmall%2F${encodeURIComponent(art)}%2F" 
                           target="_blank" rel="noopener noreferrer" 
                           style="color:var(--primary-color); text-decoration:none; font-size:0.85rem; font-weight:bold; border:1px solid var(--primary-color); padding:8px 16px; border-radius:20px; display:inline-block; background:#fff;">
                           ğŸ’¿ ${art} ã®ä½œå“ã‚’æ¥½å¤©ã§æ¢ã™
                        </a>
                        <div style="font-size:10px; color:#999; margin-top:8px;">åºƒå‘Š:å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ç§»å‹•ã—ã¾ã™</div>
                    </div>
                    </div>`; // æ—¢å­˜ã®é–‰ã˜ã‚¿ã‚°
                        

                container.appendChild(card);
            });
        }

        function openDetail(id) {
            currentId = id; 
            const l = db.lives.find(x=>x.id===id);
            if(!l) return;
            // è¡¨ç¤ºå†…å®¹ã®ã‚»ãƒƒãƒˆ
            document.getElementById('view-live-name').innerText = l.name || 'ãƒ©ã‚¤ãƒ–è©³ç´°';
            document.getElementById('live-details-info').innerHTML = `<p>ğŸ“… ${l.date}</p><p>ğŸ“ ${l.venue || 'æœªç™»éŒ²'} (${l.pref || '-'})</p><p>${l.memo||''}</p>`;
            document.getElementById('setlist-display').innerHTML = l.setlist?.length ? l.setlist.map((s,i)=>`<div>${i+1}. ${s}</div>`).join('') : 'ã‚»ãƒˆãƒªæœªç™»éŒ²';
            
            // é‡è¦ï¼šã¾ãšè©³ç´°ç”»é¢ã‚’è¦‹ã›ã¦ã€ç·¨é›†ç”»é¢ã‚’éš ã™
            document.getElementById('modal-view').classList.remove('hidden');
            document.getElementById('modal-edit').classList.add('hidden');
            document.getElementById('modal-overlay').classList.remove('hidden');
        }

// ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°ã‚’ä¿®æ­£
function switchEditMode() {
    const l = db.lives.find(x=>x.id===currentId);
    if(!l) return;
    
    document.getElementById('edit-date').value = l.date;
    document.getElementById('edit-name').value = l.name || '';
    document.getElementById('edit-venue').value = l.venue || '';
    document.getElementById('edit-pref').value = l.pref || ''; // â† è¿½åŠ ï¼šç¾åœ¨ã®éƒ½é“åºœçœŒã‚’ã‚»ãƒƒãƒˆ
    document.getElementById('edit-memo').value = l.memo || '';
    document.getElementById('edit-setlist').value = (l.setlist||[]).join('\n');
    
    document.getElementById('modal-view').classList.add('hidden');
    document.getElementById('modal-edit').classList.remove('hidden');
}

// ç·¨é›†ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°ã‚’ä¿®æ­£
function saveEdit() {
    const l = db.lives.find(x=>x.id===currentId);
    l.date = document.getElementById('edit-date').value;
    l.name = document.getElementById('edit-name').value;
    l.venue = document.getElementById('edit-venue').value;
    l.pref = document.getElementById('edit-pref').value; // â† è¿½åŠ ï¼šæ–°ã—ã„éƒ½é“åºœçœŒã‚’ä¿å­˜
    l.memo = document.getElementById('edit-memo').value;
    l.setlist = document.getElementById('edit-setlist').value.split('\n').filter(s=>s.trim());
    
    save(); 
    updateVenueSuggestions(); // ä¼šå ´ãƒã‚¹ã‚¿ãƒ¼ã‚‚æ›´æ–°
    closeModal(); 
    renderHistory();
}

        function deleteLive() { if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')){ db.lives=db.lives.filter(x=>x.id!==currentId); save(); closeModal(); renderHistory(); } }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); document.getElementById('modal-view').classList.remove('hidden'); document.getElementById('modal-edit').classList.add('hidden'); }



// ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆé¸æŠè‚¢ã‚’æ›´æ–°ï¼ˆçµ±è¨ˆã‚¿ãƒ–ã‚’é–‹ããŸã³ã«æœ€æ–°ã«ã™ã‚‹ï¼‰
function updateStatsFilter() {
    const s = document.getElementById('stats-filter-artist');
    const current = s.value;
    // é‡è¤‡ãªã—ã§ã‚½ãƒ¼ãƒˆã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆä¸€è¦§
    s.innerHTML = '<option value="all">ã™ã¹ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</option>' + 
                  [...db.artists].sort().map(a => `<option value="${a}">${a}</option>`).join('');
    s.value = current || 'all';
}

// çµ±è¨ˆæç”»ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°
// çµ±è¨ˆæç”»ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°
function renderStats() {
    updateStatsFilter();
    const filterArtist = document.getElementById('stats-filter-artist').value;
    const isAll = filterArtist === 'all';

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const targetLives = isAll ? db.lives : db.lives.filter(l => l.artist === filterArtist);

    // 1. å¹´åˆ¥ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆ
    const yearlyCounts = {};
    if (db.lives.length > 0) {
        const yearsInData = db.lives.map(l => new Date(l.date).getFullYear()).filter(y => !isNaN(y));
        const startYear = Math.min(...yearsInData);
        const currentYear = new Date().getFullYear();

        for (let y = startYear; y <= currentYear; y++) {
            yearlyCounts[y] = 0;
        }

        targetLives.forEach(l => {
            const year = new Date(l.date).getFullYear();
            if (!isNaN(year)) yearlyCounts[year]++;
        });
    }

    // é›†è¨ˆç”¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
    const counts = { artist: {}, song: {}, venue: {}, pref: {} };

    targetLives.forEach(l => {
        counts.artist[l.artist] = (counts.artist[l.artist] || 0) + 1;
        counts.venue[l.venue] = (counts.venue[l.venue] || 0) + 1;
        counts.pref[l.pref] = (counts.pref[l.pref] || 0) + 1;
        if (l.setlist && Array.isArray(l.setlist)) {
    l.setlist.forEach(s => {
        // ã€Œæ›²å|ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã€ã‚’ã‚­ãƒ¼ã«ã—ã¦ã€åˆ¥ã€…ã®æ›²ã¨ã—ã¦æ‰±ã†
        const songKey = `${s}|${l.artist}`;
        counts.song[songKey] = (counts.song[songKey] || 0) + 1;
    });
}
    });

    // [ã‚°ãƒ©ãƒ•æç”»]
    document.getElementById('total-count-display').innerText = targetLives.length;
    document.getElementById('stats-total-label').innerText = isAll ? "Total" : "Lives";
    
    const sortedArtEntries = Object.entries(counts.artist).sort((a,b) => b[1]-a[1]);
    if(chart) chart.destroy();
    chart = new Chart(document.getElementById('artistChart'), { 
        type: 'doughnut', 
        data: { 
            labels: sortedArtEntries.map(s=>s[0]), 
            datasets: [{ data: sortedArtEntries.map(s=>s[1]), backgroundColor: refinedColors, borderWidth: 0 }] 
        }, 
        options: { cutout: '80%', plugins: { legend: { display: false } } } 
    });

    // [ãƒ©ãƒ³ã‚­ãƒ³ã‚°æç”»]
    if(isAll) {
        renderRanking('stats-artist-ranking', 'ğŸ† ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ', counts.artist, 'å›', true);
    } else {
        const artistRankEl = document.getElementById('stats-artist-ranking');
        if(artistRankEl) artistRankEl.innerHTML = '';
    }

    renderRanking('stats-song-ranking', 'ğŸµ æ›²', counts.song, 'å›');
    renderYearlyRanking('stats-yearly-ranking', yearlyCounts);
    renderRanking('stats-venue-ranking', 'ğŸŸ ä¼šå ´', counts.venue, 'å›');
    
    // åœ°å›³æç”»
    const visited = [...new Set(targetLives.map(l => l.pref).filter(p => p && p !== 'æµ·å¤–' && p !== ''))];
    renderJapanMap(visited);
    document.getElementById('visited-pref-count').innerText = visited.length;
    document.getElementById('map-target-name').innerText = isAll ? 'å…¨å›½' : filterArtist;

    renderRanking('stats-pref-ranking', 'ğŸ“ éƒ½é“åºœçœŒ', counts.pref, 'å›');

    // === ğŸ›’ æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ»å¸¸æ™‚è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆã“ã“ã‹ã‚‰ï¼‰ ===
    
    // 1. ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆä½œå“ãƒªãƒ³ã‚¯ï¼ˆæ³¨é‡ˆã‚’è¿½åŠ ï¼‰
    const searchLinkContainer = document.getElementById('stats-artist-search-link');
    const targetArtName = isAll ? (sortedArtEntries[0]?.[0] || '') : filterArtist;

    if (targetArtName && searchLinkContainer) {
        const artUrl = `https://hb.afl.rakuten.co.jp/hgc/50ccba3d.194cbdf3.50ccba3e.b1170686/?pc=https%3A%2F%2Fsearch.rakuten.co.jp%2Fsearch%2Fmall%2F${encodeURIComponent(targetArtName)}%2F`;
        searchLinkContainer.innerHTML = `
            <div class="card" style="padding: 12px 10px; text-align: center; border: 1px dashed #ccc; background: #fffaf0; margin: -25px 0 15px 0; box-shadow: none; width: 100%; box-sizing: border-box;">
                <p style="font-size: 0.8rem; color: #444; margin: 0 0 8px 0; font-weight: bold; line-height: 1.4;">ä½œå“ã‚’ãƒã‚§ãƒƒã‚¯ï¼ ğŸ’¿</p>
                <a href="${artUrl}" target="_blank" rel="noopener noreferrer" style="display: inline-block; background: #bf0000; color: #fff; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.85rem;">ğŸ’¿ ${targetArtName} ã®ä½œå“ã‚’æ¥½å¤©ã§æ¢ã™</a>
                <div style="font-size: 9px; color: #999; margin-top: 6px;">åºƒå‘Š:å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ç§»å‹•ã—ã¾ã™</div>
            </div>`;
    }

    // 2. ä»–ã®ãƒªãƒ³ã‚¯ã‚’æ­£ã—ã„ä½ç½®ã«å·®ã—è¾¼ã‚€é–¢æ•°
    const insertConvenienceLink = (id, afterId, keyword, label, icon, msg) => {
        let div = document.getElementById(id);
        if (!div) {
            div = document.createElement('div');
            div.id = id;
            const targetEl = document.getElementById(afterId);
            if (targetEl) targetEl.after(div);
        }
        if (div) {
            const url = `https://hb.afl.rakuten.co.jp/hgc/50ccba3d.194cbdf3.50ccba3e.b1170686/?pc=https%3A%2F%2Fsearch.rakuten.co.jp%2Fsearch%2Fmall%2F${encodeURIComponent(keyword)}%2F`;
                        
            // --- ãƒ‡ã‚°ãƒ¬é˜²æ­¢ï¼šæ³¨é‡ˆå…¥ã‚Šã®çµ±ä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ---
            div.innerHTML = `
                <div class="card" style="padding: 12px 10px; text-align: center; border: 1px dashed #ccc; background: #fffaf0; margin: 5px 0 15px 0; box-shadow: none; width: 100%; box-sizing: border-box;">
                    <p style="font-size: 0.8rem; color: #444; margin: 0 0 8px 0; font-weight: bold; line-height: 1.4;">${msg}</p>
                    <a href="${url}" target="_blank" rel="noopener noreferrer" 
                       style="display: inline-block; background: #bf0000; color: #fff; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.85rem;">
                       ${icon} ${label}
                    </a>
                    <div style="font-size: 9px; color: #999; margin-top: 6px;">åºƒå‘Š:å¤–éƒ¨ã‚µã‚¤ãƒˆã¸ç§»å‹•ã—ã¾ã™</div>
                </div>`;
        }
    };

    insertConvenienceLink('link-audio', 'stats-song-ranking', 'æœ€æ–° ã‚¤ãƒ¤ãƒ›ãƒ³', 'æœ€æ–°ã®ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’æ¥½å¤©ã§æ¢ã™', 'ğŸ§', 'æœ€é«˜ã®éŸ³ã§æ¨ã—ã®æ›²ã‚’è´ã“ã† ğŸ§');
    insertConvenienceLink('link-binocular', 'stats-yearly-ranking', 'é˜²æŒ¯åŒçœ¼é¡', 'é˜²æŒ¯åŒçœ¼é¡ã‚’æ¥½å¤©ã§æ¢ã™', 'ğŸ”­', 'åºƒã„ä¼šå ´ã§ã‚‚æ¨ã—ã‚’ãƒ­ãƒƒã‚¯ã‚ªãƒ³ï¼ ğŸ”­');
    insertConvenienceLink('link-battery', 'stats-venue-ranking', 'ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ Anker ã‚¨ãƒ¬ã‚³ãƒ ', 'ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ã‚’æ¥½å¤©ã§æ¢ã™', 'ğŸ”‹', 'é å¾ä¸­ã®é›»æ± åˆ‡ã‚Œã‚’é˜²ã âš¡ï¸');
    insertConvenienceLink('link-silvtape', 'stats-pref-ranking', 'éŠ€ãƒ†ãƒ¼ãƒ— ã‚±ãƒ¼ã‚¹', 'éŠ€ãƒ†ãƒ¼ãƒ—ã‚±ãƒ¼ã‚¹ã‚’æ¥½å¤©ã§æ¢ã™', 'ğŸï¸', 'å¤§åˆ‡ãªéŠ€ãƒ†ãƒ¼ãƒ—ã‚’ç¶ºéº—ã«ä¿ç®¡ âœ¨');
    
    // === ğŸ›’ å¸¸æ™‚è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆã“ã“ã¾ã§ï¼‰ ===
}


// å¹´åˆ¥å°‚ç”¨ã®æç”»é–¢æ•°
function renderYearlyRanking(id, dataObj) {
    const container = document.getElementById(id);
    const sortedYears = Object.entries(dataObj).sort((a, b) => b[0] - a[0]);

    // 1ä»¶ã‚‚ãƒ‡ãƒ¼ã‚¿ï¼ˆå¹´ï¼‰ãŒãªã„å ´åˆ
    if (sortedYears.length === 0) {
        container.innerHTML = `<div class="card"><span class="section-title">ğŸ“… å¹´åˆ¥å‚æˆ¦æ•°</span><div style="text-align:center; padding:20px; color:#8e8e93; font-size:0.9rem;">ãƒ©ã‚¤ãƒ–ã‚’ç™»éŒ²ã™ã‚‹ã¨å¹´è¡¨ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div></div>`;
        return;
    }

    const maxCount = Math.max(...Object.values(dataObj), 1);
    let html = `<div class="card"><span class="section-title">ğŸ“… å¹´åˆ¥å‚æˆ¦æ•°</span>`;

    sortedYears.forEach((entry, i) => {
        const year = entry[0];
        const count = entry[1];
        const barWidth = (count / maxCount) * 100;
        
        // 11ä½ä»¥é™ã‚’éš ã™è¨­å®š
        const isHidden = i >= 10;
        const displayStyle = isHidden ? 'none' : 'flex';
        const hiddenClass = isHidden ? 'rank-item-hidden' : '';

        html += `
            <div class="stats-list-item ${hiddenClass}" data-group="${id}" style="padding: 12px 0; align-items:center; display:${displayStyle}; width:100%;">
                <div class="year-text" style="width:50px; flex-shrink:0; font-weight:bold; ${count === 0 ? 'opacity:0.3;' : ''}">${year}</div>
                <div class="yearly-bar-container" style="flex:1; height:8px; background:#f2f2f7; border-radius:4px; margin:0 10px; overflow:hidden;">
                    <div class="yearly-bar-fill" style="width: ${barWidth}%; height:100%; background:linear-gradient(90deg, #ff9500, #ffcc00); border-radius:4px; opacity:${count === 0 ? '0' : '1'};"></div>
                </div>
                <div style="font-weight:900; color:${count === 0 ? '#c7c7cc' : 'var(--primary-color)'}; min-width:35px; text-align:right;">
                    ${count}<small style="font-size:0.6rem; font-weight:bold;">å›</small>
                </div>
            </div>`;
    });

    if (sortedYears.length > 10) {
        html += `<button id="${id}-btn" class="show-more-btn" onclick="toggleRankingNew('${id}')">ã‚‚ã£ã¨è¦‹ã‚‹ â–¼</button>`;
    }

    html += '</div>';
    container.innerHTML = html;
}

// çµ±è¨ˆæç”»å†…ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
function renderRanking(id, title, dataObj, unit, isArtistRank = false) {
    const container = document.getElementById(id);
    const sorted = Object.entries(dataObj)
        .filter(e => e[0] && e[0] !== 'undefined' && e[0] !== '')
        .sort((a,b) => b[1]-a[1]);
    
    if (sorted.length === 0) { container.innerHTML = ''; return; }

    let html = `<div class="card"><span class="section-title">${title}ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>`;
    let lastVal = -1;

    sorted.forEach((entry, i) => {
        const currentRank = i + 1;
        const rankText = entry[1] === lastVal ? '' : currentRank + 'ä½';
        lastVal = entry[1];
        
        const isHidden = currentRank > 10;
        const displayStyle = isHidden ? 'none' : 'flex';
        const hiddenClass = isHidden ? 'rank-item-hidden' : '';
        
        const detailId = `detail-${id}-${i}`;
        
        // --- ä¿®æ­£ã®è¦ï¼šå¤‰æ•°ã®å®šç¾© ---
        const targetKey = entry[0]; // å…ƒã®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ›²å|ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå ãªã©ï¼‰
        let displayTitle = targetKey;
        let artistNameForSearch = "";

        // æ›²ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®å ´åˆã¯ã‚­ãƒ¼ã‚’åˆ†è§£ã™ã‚‹
        if (id === 'stats-song-ranking' && targetKey.includes('|')) {
            const parts = targetKey.split('|');
            displayTitle = parts[0];       // è¡¨ç¤ºç”¨ã®æ›²å
            artistNameForSearch = parts[1]; // æ¤œç´¢ç”¨ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå
        }

        const targetName = displayTitle; // è¡¨ç¤ºç”¨ã®åå‰ã‚’ç¢ºå®š

        // æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã®çµ„ã¿ç«‹ã¦
        let searchQuery = targetName;
        if (id === 'stats-song-ranking') {
            const filterArtist = document.getElementById('stats-filter-artist').value;
            if (filterArtist !== 'all') {
                searchQuery = targetName + " " + filterArtist;
            } else if (artistNameForSearch) {
                searchQuery = targetName + " " + artistNameForSearch;
            }
        }
        const encodedSearch = encodeURIComponent(searchQuery);

        // å„ã‚¢ãƒ—ãƒªã¸ã®å°‚ç”¨ãƒªãƒ³ã‚¯
        const appleMusicUrl = `music://music.apple.com/search?term=${encodedSearch}`;
        const spotifyUrl = `spotify:search:${encodedSearch}`;

        let musicLinksHtml = '';
        if (id === 'stats-artist-ranking' || id === 'stats-song-ranking') {
            musicLinksHtml = `
                <div class="music-links" style="display: flex; gap: 8px; margin: 0 10px; flex-shrink:0;">
                    <a href="${appleMusicUrl}" target="_blank" rel="noopener noreferrer" 
                       style="text-decoration:none; width:26px; height:26px; display:flex; align-items:center; justify-content:center; background:#fa243c; border-radius:6px; font-size:13px; color:white;">ğŸ</a>
                    <a href="${spotifyUrl}" target="_blank" rel="noopener noreferrer" 
                       style="text-decoration:none; width:26px; height:26px; display:flex; align-items:center; justify-content:center; background:#1DB954; border-radius:50%; font-size:11px; color:white; font-weight:bold;">S</a>
                </div>`;
        }

        html += `
            <div class="stats-list-item-container ${hiddenClass}" data-group="${id}" style="display:${displayStyle}; flex-direction:column; width:100%;">
                <div class="stats-list-item" style="display: flex; align-items:center; width:100%; border-bottom:1px solid #f2f2f7; padding: 10px 0;">
                    <div class="rank-num" style="min-width:40px; flex-shrink:0; font-size:0.85rem; color:#8e8e93;">${rankText}</div>
                    
                    <div style="flex:1; min-width:0; overflow:hidden; text-overflow:ellipsis; cursor:pointer; font-weight:500;" 
                         onclick="${isArtistRank ? `switchStatsTarget('${targetName.replace(/'/g, "\\'")}')` : `toggleStatsDetail('${detailId}', '${id}', '${targetKey.replace(/'/g, "\\'")}')`}">
                        ${targetName}
                    </div>

                    ${musicLinksHtml}

                    <div style="font-weight:bold; color:var(--primary-color); flex-shrink:0; min-width:40px; text-align:right;">
                        ${entry[1]}<small style="font-size:0.6rem; margin-left:1px;">${unit}</small>
                    </div>
                </div>
                <div id="${detailId}" class="stats-detail-list hidden"></div>
            </div>`;
    });

    if (sorted.length > 10) {
        html += `<button id="${id}-btn" class="show-more-btn" onclick="toggleRankingNew('${id}')">ã‚‚ã£ã¨è¦‹ã‚‹ â–¼</button>`;
    }

    html += '</div>';
    container.innerHTML = html;
}

function toggleStatsDetail(detailId, type, value) {
    const detailDiv = document.getElementById(detailId);
    
    // ã™ã§ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹ï¼ˆãƒˆã‚°ãƒ«ï¼‰
    if (!detailDiv.classList.contains('hidden')) {
        detailDiv.classList.add('hidden');
        return;
    }

    // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çŠ¶æ…‹ã‚’å–å¾—
    const filterArtist = document.getElementById('stats-filter-artist').value;
    const isFiltered = filterArtist !== 'all';

    // â˜…é‡è¦ï¼šæ›²ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®å ´åˆã¯ã€Œæ›²å|ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã€ã‚’åˆ†è§£ã™ã‚‹
    let targetSongName = value;
    let targetArtistName = null;
    if (type === 'stats-song-ranking' && value.includes('|')) {
        const parts = value.split('|');
        targetSongName = parts[0];
        targetArtistName = parts[1];
    }

    // è©²å½“ã™ã‚‹ãƒ©ã‚¤ãƒ–ã‚’æŠ½å‡º
    let filteredLives = db.lives.filter(l => {
        const matchesArtist = isFiltered ? l.artist === filterArtist : true;
        let matchesValue = false;
        
        if (type === 'stats-song-ranking') {
            // æ›²åãŒä¸€è‡´ã—ã€ã‹ã¤ï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãŒåˆ¤åˆ¥ã§ãã‚Œã°ï¼‰ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚‚ä¸€è‡´ã™ã‚‹ã‚‚ã®
            const songMatch = l.setlist && l.setlist.includes(targetSongName);
            const artistMatch = targetArtistName ? (l.artist === targetArtistName) : true;
            matchesValue = songMatch && artistMatch;
        }
        if (type === 'stats-venue-ranking') matchesValue = l.venue === value;
        if (type === 'stats-pref-ranking') matchesValue = l.pref === value;
        
        return matchesArtist && matchesValue;
    });

    // æ—¥ä»˜é †ï¼ˆæ–°ã—ã„é †ï¼‰ã«ã‚½ãƒ¼ãƒˆ
    filteredLives.sort((a, b) => new Date(b.date) - new Date(a.date));

    // HTMLç”Ÿæˆ
    let html = '';
    if (filteredLives.length === 0) {
        html = '<div class="stats-detail-item" style="color:#8e8e93; font-size:0.8rem;">å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
    } else {
        filteredLives.forEach(l => {
            const artistSpan = isFiltered ? '' : `<span class="stats-detail-artist">${l.artist}</span><br>`;
            
            let subInfo = '';
            if (type === 'stats-song-ranking') subInfo = ` @ ${l.venue || 'ä¼šå ´æœªè¨­å®š'}`;
            if (type === 'stats-venue-ranking') subInfo = ` (${l.pref || '-'})`;
            if (type === 'stats-pref-ranking') subInfo = ` @ ${l.venue || 'ä¼šå ´æœªè¨­å®š'}`;

            html += `
                <div class="stats-detail-item">
                    <span class="stats-detail-date">${l.date}</span>
                    ${artistSpan}
                    <span style="color:#444;">${l.name || '(ç„¡é¡Œ)'}</span>
                    <span style="color:#8e8e93; font-size:0.75rem;">${subInfo}</span>
                </div>`;
        });
    }

    detailDiv.innerHTML = html;
    detailDiv.classList.remove('hidden');
}



function toggleRankingNew(id) {
    const items = document.querySelectorAll(`[data-group="${id}"].rank-item-hidden`);
    const btn = document.getElementById(id + '-btn');
    const isOpening = btn.innerText.includes('ã‚‚ã£ã¨è¦‹ã‚‹');

    items.forEach(item => {
        // blockã§ã¯ãªãã€çµ¶å¯¾ã« flex ã‚’æŒ‡å®š
        item.style.setProperty('display', isOpening ? 'flex' : 'none', 'important');
    });

    btn.innerText = isOpening ? 'é–‰ã˜ã‚‹ â–²' : 'ã‚‚ã£ã¨è¦‹ã‚‹ â–¼';
}



// ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‹ã‚‰å€‹åˆ¥ã®çµ±è¨ˆã«é£›ã°ã™é–¢æ•°
function switchStatsTarget(name) {
    document.getElementById('stats-filter-artist').value = name;
    renderStats();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

        // åœ°å›³ã‚’ç”Ÿæˆã™ã‚‹å°‚ç”¨é–¢æ•°
function renderJapanMap(visited) {
    const container = document.getElementById('japan-map');
    if (!container) return;

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸç¾åœ¨ã®ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€å„éƒ½é“åºœçœŒã®è¨ªå•å›æ•°ã‚’é›†è¨ˆ
    const filterArtist = document.getElementById('stats-filter-artist').value;
    const targetLives = filterArtist === 'all' ? db.lives : db.lives.filter(l => l.artist === filterArtist);
    
    const counts = {};
    targetLives.forEach(l => {
        if (l.pref && l.pref !== 'æµ·å¤–') {
            counts[l.pref] = (counts[l.pref] || 0) + 1;
        }
    });

    // æœ€å¤§è¨ªå•å›æ•°ã‚’å–å¾—ï¼ˆè‰²ã®æ¿ƒã•ã®åŸºæº–ã«ã™ã‚‹ï¼‰
    const maxVisit = Math.max(...Object.values(counts), 0);

    const s = 22; 
    const ox = 75, oy = 20;

    // éƒ½é“åºœçœŒé…ç½®ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¢å­˜ã®ã‚‚ã®ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼‰
    const mapData = [
        {p:'åŒ—æµ·é“', x:ox+s*9, y:oy+s*0, w:s*3, h:s*2, big:true},
        {p:'é’æ£®çœŒ', x:ox+s*9, y:oy+s*3, w:s*2, h:s},
        {p:'ç§‹ç”°çœŒ', x:ox+s*9, y:oy+s*4}, {p:'å²©æ‰‹çœŒ', x:ox+s*10, y:oy+s*4},
        {p:'å±±å½¢çœŒ', x:ox+s*9, y:oy+s*5}, {p:'å®®åŸçœŒ', x:ox+s*10, y:oy+s*5},
        {p:'ç¦å³¶çœŒ', x:ox+s*9, y:oy+s*6, w:s*2, h:s},
        {p:'æ–°æ½ŸçœŒ', x:ox+s*7, y:oy+s*6, w:s*2, h:s},
        {p:'å¯Œå±±çœŒ', x:ox+s*6, y:oy+s*6}, {p:'çŸ³å·çœŒ', x:ox+s*5, y:oy+s*6},
        {p:'é•·é‡çœŒ', x:ox+s*7, y:oy+s*7, w:s, h:s*2},
        {p:'ç¦äº•çœŒ', x:ox+s*5, y:oy+s*7},
        {p:'å²é˜œçœŒ', x:ox+s*6, y:oy+s*7, w:s, h:s*2},
        {p:'å±±æ¢¨çœŒ', x:ox+s*8, y:oy+s*8}, {p:'æ„›çŸ¥çœŒ', x:ox+s*6, y:oy+s*9},
        {p:'é™å²¡çœŒ', x:ox+s*7, y:oy+s*9},
        {p:'æ ƒæœ¨çœŒ', x:ox+s*9, y:oy+s*7}, {p:'ç¾¤é¦¬çœŒ', x:ox+s*8, y:oy+s*7},
        {p:'èŒ¨åŸçœŒ', x:ox+s*10, y:oy+s*7, w:s, h:s*2}, {p:'åŸ¼ç‰çœŒ', x:ox+s*9, y:oy+s*8},
        {p:'åƒè‘‰çœŒ', x:ox+s*10, y:oy+s*9, w:s, h:s*2},
        {p:'æ±äº¬éƒ½', x:ox+s*9, y:oy+s*9}, {p:'ç¥å¥ˆå·çœŒ', x:ox+s*8, y:oy+s*9},
        {p:'æ»‹è³€çœŒ', x:ox+s*5, y:oy+s*8}, {p:'äº¬éƒ½åºœ', x:ox+s*4, y:oy+s*7},
        {p:'å¤§é˜ªåºœ', x:ox+s*4, y:oy+s*8}, {p:'å¥ˆè‰¯çœŒ', x:ox+s*4, y:oy+s*9},
        {p:'ä¸‰é‡çœŒ', x:ox+s*5, y:oy+s*9},
        {p:'å…µåº«çœŒ', x:ox+s*3, y:oy+s*7, w:s, h:s*2},
        {p:'å’Œæ­Œå±±çœŒ', x:ox+s*4, y:oy+s*10, w:s*2, h:s},
        {p:'é³¥å–çœŒ', x:ox+s*2, y:oy+s*7}, {p:'å³¶æ ¹çœŒ', x:ox+s*1, y:oy+s*7},
        {p:'å²¡å±±çœŒ', x:ox+s*2, y:oy+s*8},
        {p:'åºƒå³¶çœŒ', x:ox+s*1, y:oy+s*8},
        {p:'å±±å£çœŒ', x:ox+s*0, y:oy+s*7, w:s, h:s*2},
        {p:'é¦™å·çœŒ', x:ox+s*2, y:oy+s*10}, {p:'å¾³å³¶çœŒ', x:ox+s*2, y:oy+s*11},
        {p:'æ„›åª›çœŒ', x:ox+s*1, y:oy+s*10}, {p:'é«˜çŸ¥çœŒ', x:ox+s*1, y:oy+s*11},
        {p:'ç¦å²¡çœŒ', x:ox-s*2, y:oy+s*8}, {p:'ä½è³€çœŒ', x:ox-s*3, y:oy+s*8}, {p:'å¤§åˆ†çœŒ', x:ox-s*2, y:oy+s*9},
        {p:'é•·å´çœŒ', x:ox-s*3, y:oy+s*9}, {p:'ç†Šæœ¬çœŒ', x:ox-s*3, y:oy+s*10}, {p:'å®®å´çœŒ', x:ox-s*2, y:oy+s*10},
        {p:'é¹¿å…å³¶çœŒ', x:ox-s*3, y:oy+s*11, w:s*2, h:s},
        {p:'æ²–ç¸„çœŒ', x:ox-s*3, y:oy+s*14}
    ];

    let svgHtml = `<svg viewBox="0 0 350 420" width="100%" height="auto">`;

    mapData.forEach(d => {
        const count = counts[d.p] || 0;
        const isVisited = count > 0;
        
        // æ¿ƒæ·¡ã®è¨ˆç®—: å›æ•°ãŒå¤šã„ã»ã©ä¸é€æ˜åº¦(opacity)ã‚’ä¸Šã’ã‚‹ (æœ€å°0.2, æœ€å¤§1.0)
        // 1å›ã ã‘ã®ã¨ãã¯å°‘ã—è–„ãã€å›æ•°ãŒå¢—ãˆã‚‹ã»ã©ãƒ‘ã‚­ãƒƒã¨ã—ãŸç·‘ã«ãªã‚Šã¾ã™
        const opacity = isVisited ? Math.max(0.2, count / maxVisit) : 1;
        const color = isVisited ? `rgba(0, 113, 48, ${opacity})` : '#f2f2f7';
        const textColor = isVisited ? (opacity > 0.5 ? '#ffffff' : '#007130') : '#8e8e93';
        
        const w = d.w || s;
        const h = d.h || s;
        const displayCode = prefCodes[d.p] || d.p.charAt(0);
        const fontSize = d.big ? 11 : 7.5;
        
        svgHtml += `
            <g style="cursor:pointer;" onclick="toggleStatsDetail('detail-stats-pref-ranking-manual', 'stats-pref-ranking', '${d.p}')">
                <rect x="${d.x}" y="${d.y}" width="${w}" height="${h}" rx="2" fill="${color}" stroke="#ffffff" stroke-width="0.5" />
                <text x="${d.x + w/2}" y="${d.y + h/2 + 3}" font-size="${fontSize}" font-weight="900" text-anchor="middle" fill="${textColor}" style="pointer-events:none; font-family: -apple-system, sans-serif;">${displayCode}</text>
            </g>`;
    });
    
    container.innerHTML = svgHtml + `</svg>
    <div id="detail-stats-pref-ranking-manual" class="stats-detail-list hidden" style="margin-top:10px;"></div>`;
}


// ç®¡ç†ç”»é¢ã®ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹é–¢æ•°
function renderArtistManager() {
    const searchInput = document.getElementById('artist-search-input');
    const q = searchInput ? searchInput.value.toLowerCase() : "";
    const listContainer = document.getElementById('artist-manager-list');
    
    if (!listContainer) return;

    listContainer.innerHTML = db.artists
        .filter(a => a.toLowerCase().includes(q))
        .sort()
        .map(a => `
            <div class="artist-admin-row">
                <span class="artist-name-text">${a}</span>
                <div class="admin-btn-group">
                    <button onclick="editArtistName('${a}')" class="btn-mini btn-edit">ç·¨é›†</button>
                    <button onclick="deleteArtist('${a}')" class="btn-mini btn-delete">å‰Šé™¤</button>
                </div>
            </div>`).join('') || '<div style="padding:20px; text-align:center; color:#8e8e93;">è©²å½“ãªã—</div>';
}

        function filterArtists() { renderArtistManager(); }

        function editArtistName(old) {
            const n = prompt('æ–°ã—ã„åå‰', old);
            if (!n || n === old) return;

            // 1. ã™ã§ã«ãã®åå‰ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const exists = db.artists.includes(n);

            if (exists) {
                if (confirm(`ã€Œ${n}ã€ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚å±¥æ­´ã‚’çµ±åˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
                    // æ—¢å­˜ã®Aã«çµ±åˆã™ã‚‹å ´åˆï¼šå¤ã„Bã‚’å‰Šé™¤ã™ã‚‹ã ã‘ï¼ˆå±¥æ­´ã¯ä¸‹ã®å‡¦ç†ã§Aã«æ›¸ãæ›ã‚ã‚‹ï¼‰
                    db.artists = db.artists.filter(a => a !== old);
                } else {
                    return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                }
            } else {
                // å­˜åœ¨ã—ãªã„åå‰ãªã‚‰ã€æ™®é€šã«åå‰ã‚’ä¸Šæ›¸ã
                db.artists[db.artists.indexOf(old)] = n;
            }

            // 2. å±¥æ­´ï¼ˆlivesï¼‰ã®ä¸­ã«ã‚ã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã‚’ã™ã¹ã¦æ–°ã—ã„åå‰ã«æ›¸ãæ›ãˆã‚‹
            db.lives.forEach(l => {
                if (l.artist === old) l.artist = n;
            });

            save();
            renderArtistManager();
            if(document.getElementById('page-history').classList.contains('active')) renderHistory();
        }

// --- ã‚·ã‚§ã‚¢ãƒ¬ãƒãƒ¼ãƒˆç”¨ï¼šã“ã“ã‹ã‚‰ ---
let selectedThemeColor = '#007130'; 

// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãéš›ã«é¸æŠè‚¢ã‚’æœ€æ–°ã«ã™ã‚‹
function openShareModal() {
    // æœŸé–“ï¼ˆå¹´ï¼‰ã®é¸æŠè‚¢ã‚’è‡ªå‹•ç”Ÿæˆ
    const periodSelect = document.getElementById('share-period-type');
    const years = [...new Set(db.lives.map(l => l.date.split('-')[0]))].sort().reverse();
    
    periodSelect.innerHTML = '<option value="all">ALL TIMEï¼ˆå…¨æœŸé–“ï¼‰</option>';
    years.forEach(y => {
        if(y) periodSelect.innerHTML += `<option value="${y}">${y}å¹´ (Yearly)</option>`;
    });

    // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã®é¸æŠè‚¢ã‚’è‡ªå‹•ç”Ÿæˆ
    const artistSelect = document.getElementById('share-artist-type');
    artistSelect.innerHTML = '<option value="all">ALL Artistsï¼ˆå…¨å¯¾è±¡ï¼‰</option>';
    db.artists.sort().forEach(a => {
        artistSelect.innerHTML += `<option value="${a}">${a}</option>`;
    });

    document.getElementById('share-modal').classList.remove('hidden');
}


function closeShareModal() {
    document.getElementById('share-modal').classList.add('hidden');
}

function setTheme(color) {
    selectedThemeColor = color;
    const btn = document.querySelector('#share-modal .accent-btn');
    if(btn) {
        btn.style.background = color;
        
        // è‰²ã®æ˜ã‚‹ã•ã‚’åˆ¤å®šã—ã¦ã€æ–‡å­—è‰²ã‚’é»’ã‹ç™½ã«è‡ªå‹•ã§åˆ‡ã‚Šæ›¿ãˆã‚‹
        const c = color.replace('#', '');
        const r = parseInt(c.substr(0,2), 16);
        const g = parseInt(c.substr(2,2), 16);
        const b = parseInt(c.substr(4,2), 16);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        
        // æ˜ã‚‹ã„è‰²ã®ã¨ãã¯æ–‡å­—ã‚’é»’(#333)ã€æš—ã„è‰²ã®ã¨ãã¯ç™½ã«
        btn.style.color = brightness > 150 ? '#333' : '#fff';
        
        // ç™½ã®ã¨ãã ã‘ãƒœã‚¿ãƒ³ã«è–„ã„æ ç·šã‚’ã¤ã‘ã‚‹ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ç”¨ï¼‰
        btn.style.border = brightness > 240 ? '1px solid #ccc' : 'none';
    }
}

function toggleShareFilter() {
    const type = document.getElementById('share-type').value;
    const detail = document.getElementById('share-filter-detail');
    if(!detail) return;
    detail.innerHTML = '';

    if (type === 'annual') {
        const years = [...new Set(db.lives.map(l => l.date.split('-')[0]))].sort().reverse();
        detail.innerHTML = `<select id="filter-year" style="margin-top:10px;">${years.length ? years.map(y => `<option value="${y}">${y}å¹´</option>`).join('') : '<option value="">å±¥æ­´ãªã—</option>'}</select>`;
    } else if (type === 'monthly') {
        detail.innerHTML = `<input type="month" id="filter-month" value="${new Date().toISOString().slice(0, 7)}" style="margin-top:10px;">`;
    } else if (type === 'artist') {
        detail.innerHTML = `<select id="filter-artist" style="margin-top:10px;">${db.artists.length ? db.artists.sort().map(a => `<option value="${a}">${a}</option>`).join('') : '<option value="">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãªã—</option>'}</select>`;
    }
}

// é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ã®å¼·åŒ–
function calculateReportStats(lives) {
    const songCounts = {};
    const venueCounts = {};
    const prefCounts = {};
    const artistCounts = {};
    let totalSongs = 0;

    lives.forEach(l => {
        if(l.artist) artistCounts[l.artist] = (artistCounts[l.artist] || 0) + 1;
        if(l.venue) venueCounts[l.venue] = (venueCounts[l.venue] || 0) + 1;
        if(l.pref) prefCounts[l.pref] = (prefCounts[l.pref] || 0) + 1;
        if (l.setlist) {
            totalSongs += l.setlist.length;
            l.setlist.forEach(s => songCounts[s] = (songCounts[s] || 0) + 1);
        }
    });

    // --- ã“ã“ã‹ã‚‰ getTop ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£ ---
    const getTop = (obj) => {
        const entries = Object.entries(obj).sort((a, b) => b[1] - a[1]);
        if (entries.length === 0) return { text: "-", count: 0, others: 0 };
        
        const maxCount = entries[0][1];
        const tops = entries.filter(e => e[1] === maxCount);
        
        // 2ä½ã¾ã§ã‚’æ”¹è¡Œã§ã¤ãªãã€‚3ä½ä»¥é™ãŒã‚ã‚Œã°ãã®ä»¶æ•°ã‚’æ•°ãˆã‚‹
        let displayText = tops.slice(0, 2).map(e => e[0]).join('<br>');
        let othersCount = tops.length > 2 ? tops.length - 2 : 0;
        
        return {
            text: displayText,
            count: maxCount,
            others: othersCount
        };
    };

    return {
        totalLives: lives.length,
        totalArtists: Object.keys(artistCounts).length,
        totalSongs: totalSongs,
        totalVenues: Object.keys(venueCounts).length,
        totalPrefs: Object.keys(prefCounts).length,
        // å„é …ç›®ã‚’æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§è¿”ã™
        topArtist: getTop(artistCounts),
        topSong: getTop(songCounts),
        topVenue: getTop(venueCounts),
        topPref: getTop(prefCounts)
    };
}

// ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆæ–°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
function generateReport() {
    const selectedYear = document.getElementById('share-period-type').value;
    const selectedArtist = document.getElementById('share-artist-type').value;
    let filteredLives = db.lives;

    if (selectedYear !== 'all') filteredLives = filteredLives.filter(l => l.date.startsWith(selectedYear));
    if (selectedArtist !== 'all') filteredLives = filteredLives.filter(l => l.artist === selectedArtist);

    if (filteredLives.length === 0) { alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"); return; }

    const stats = calculateReportStats(filteredLives);
    const container = document.getElementById('report-card-container');
    const periodDisplay = selectedYear === 'all' ? 'ALL TIME' : selectedYear + ' YEAR';

    // èƒŒæ™¯ã®æ˜ã‚‹ã•ã‚’åˆ¤å®šã—ã¦æ–‡å­—è‰²ã‚’æ±ºå®š
    const hex = selectedThemeColor.replace('#', '');
    const r = parseInt(hex.substr(0,2), 16);
    const g = parseInt(hex.substr(2,2), 16);
    const b = parseInt(hex.substr(4,2), 16);
    const brightness = (r * 299 + g * 587 + b * 114) / 1000;
    const isLight = brightness > 180;

    // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®æ–‡å­—è‰²ã‚¯ãƒ©ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    container.className = isLight ? 'report-theme-light' : 'report-theme-dark';
    
    // ğŸŒŸã€ã“ã“ã‚’æ›¸ãæ›ãˆï¼ã€‘ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’ã‚ˆã‚Šå …ç‰¢ã«ã™ã‚‹
    // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®æ–‡å­—è‰²ã‚¯ãƒ©ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    container.className = isLight ? 'report-theme-light' : 'report-theme-dark';
    
    // ğŸŒŸ æ»‘ã‚‰ã‹ãªã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ãƒã‚¤ã‚ºç”»åƒãƒ‡ãƒ¼ã‚¿
    const noiseUrl = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAMAAAA9YU9LAAAABGdBTUEAALGPC/xhBQAAABRQTFRFMS0xISEhISEhISEhISEhISEhISEhIdmS3wAAAAZ0Uk5TAB8fPz8/P1YmXm0AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAuSURBVDjLY2CAA0YmIDLBBEMmJpYIKgaKIDKBBEMmBmoaiIEYKKIYiIEYKCIYCAD6uAEXm9OnfQAAAABJRU5ErkJggg==";

    // ğŸŒŸ èƒŒæ™¯è¨­å®šï¼šãƒã‚¤ã‚ºã¨ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡ã­ã¦é©ç”¨
    container.style.background = `url("${noiseUrl}"), linear-gradient(135deg, ${selectedThemeColor} 0%, ${adjustColor(selectedThemeColor, -30)} 100%)`;
    container.style.backgroundBlendMode = "overlay"; // ãƒã‚¤ã‚ºã‚’é¦´æŸ“ã¾ã›ã‚‹
    container.style.backgroundSize = "64px 64px, 100% 100%"; // ãƒã‚¤ã‚ºã®ç´°ã‹ã•ã‚’æŒ‡å®š
    container.style.backgroundRepeat = "repeat, no-repeat";
    container.style.backgroundAttachment = "scroll";

    container.innerHTML = `
        <div class="report-header">
            <div class="report-title">LIVE DIARY REPORT</div>
            <div class="report-period">${periodDisplay} / ${selectedArtist === 'all' ? 'ALL ARTISTS' : selectedArtist}</div>
        </div>
        
        <div class="report-section-label">TOTAL STATS</div>
        <div class="report-grid-mini">
            <div class="report-item"><span class="report-label">ãƒ©ã‚¤ãƒ–æ•°</span><span class="report-value">${stats.totalLives}</span></div>
            <div class="report-item"><span class="report-label">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</span><span class="report-value">${stats.totalArtists}</span></div>
            <div class="report-item"><span class="report-label">æ›²æ•°</span><span class="report-value">${stats.totalSongs}</span></div>
            <div class="report-item"><span class="report-label">ä¼šå ´æ•°</span><span class="report-value">${stats.totalVenues}</span></div>
            <div class="report-item"><span class="report-label">åˆ¶è¦‡éƒ½é“åºœçœŒ</span><span class="report-value">${stats.totalPrefs}<small>/47</small></span></div>
        </div>

        <div class="report-section-label" style="margin-top:15px;">TOP RECORDS</div>

<div class="report-best-list">
    ${[
        { label: 'BEST ARTIST', data: stats.topArtist },
        { label: 'BEST MUSIC', data: stats.topSong },
        { label: 'BEST PLACE', data: stats.topVenue }
    ].map(item => `
        <div class="best-entry">
            <span class="report-label">${item.label}</span>
            <div class="best-main-content">
                <div class="report-value-long">${item.data.text}</div>
                ${item.data.others > 0 ? `<div class="report-others-count">ï¼‹ ä»–${item.data.others}ä»¶</div>` : ''}
                <div class="best-count-display">${item.data.count}<small>å›</small></div>
            </div>
        </div>
    `).join('')}
</div>
    <div class="report-footer" style="text-align: right; margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.4;">
        <div style="font-size: 0.8rem; font-weight: bold; margin-bottom: 2px;">Generated by LIVE DIARY ğŸŠ</div>
        <div style="font-size: 0.55rem; opacity: 0.8; font-family: 'Helvetica Neue', Arial, sans-serif; letter-spacing: 0.2px;">
            https://livediary-app.com/
        </div>
    </div>
`;


// generateReport é–¢æ•°ã®æœ€å¾Œï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ç›´å‰ï¼‰ã«ã“ã‚Œã‚’è¿½åŠ 
const reportCard = document.getElementById('report-card-container');
const windowHeight = window.innerHeight;
const safeHeight = windowHeight * 0.8; // ç”»é¢ã®8å‰²ã®é«˜ã•ã«åã‚ã‚‹

// ã‚«ãƒ¼ãƒ‰ã®å®Ÿéš›ã®é«˜ã•ã‚’å–å¾—ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¨ˆç®—
reportCard.style.transform = 'scale(1)'; // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
const cardHeight = reportCard.offsetHeight;

if (cardHeight > safeHeight) {
    const scale = safeHeight / cardHeight;
    reportCard.style.transform = `scale(${scale})`;
    reportCard.style.transformOrigin = 'top center';
} else {
    reportCard.style.transform = 'scale(1)';
}





    document.getElementById('report-preview-overlay').classList.remove('hidden');
    closeShareModal();
}

// è‰²ã‚’æš—ãã™ã‚‹è£œåŠ©é–¢æ•°
function adjustColor(color, percent) {
    const num = parseInt(color.replace('#',''),16),
    amt = Math.round(2.55 * percent),
    R = (num >> 16) + amt,
    G = (num >> 8 & 0x00FF) + amt,
    B = (num & 0x0000FF) + amt;
    return "#" + (0x1000000 + (R<255?R<0?0:R:255)*0x10000 + (G<255?G<0?0:G:255)*0x100 + (B<255?B<0?0:B:255)).toString(16).slice(1);
}


// ã€ä¿®æ­£ç‰ˆã€‘é«˜ç”»è³ªåŒ–å¯¾å¿œæ¸ˆã¿ã®ç”»åƒä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯
async function saveReportImage() {
    const card = document.getElementById('report-card-container');
    const originalTransform = card.style.transform;
    const originalBg = card.style.background;
    const bestEntries = card.querySelectorAll('.best-entry');

    // 1. æº–å‚™ï¼šhtml2canvasã«ã€Œä½™è¨ˆãªã“ã¨ã€ã‚’ã•ã›ãªã„è¨­å®š
    card.style.transform = 'none';
    card.style.background = 'transparent'; // èƒŒæ™¯ã‚’é€æ˜ã«ã—ã¦ã€html2canvasã«ã¯æ–‡å­—ã ã‘æ’®ã‚‰ã›ã‚‹

    // ğŸŒŸ åŠ£åŒ–ã®åŸå› ã€Œã¼ã‹ã—ã€ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ã—ã€è‰²å‘³ã‚’ç¶­æŒã™ã‚‹
    const originalStyles = [];
    bestEntries.forEach((entry, i) => {
        originalStyles[i] = {
            backdrop: entry.style.backdropFilter,
            webkitBackdrop: entry.style.webkitBackdropFilter,
            bg: entry.style.background
        };
        entry.style.backdropFilter = 'none';
        entry.style.webkitBackdropFilter = 'none';
        // åŠé€æ˜ã®ç™½ã§ä»£ç”¨ï¼ˆæç”»ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãï¼‰
        entry.style.background = 'rgba(255, 255, 255, 0.1)'; 
    });

    try {
        // 2. æ–‡å­—ã¨æ ã ã‘ã®é€æ˜ãªç”»åƒã‚’ç”Ÿæˆï¼ˆã“ã“ã¯html2canvasãŒå¾—æ„ãªé ˜åŸŸï¼‰
        const contentCanvas = await html2canvas(card, {
            scale: 3,
            useCORS: true,
            backgroundColor: null,
            logging: false
        });

        // 3. ğŸŒŸã€ã“ã“ãŒå¿ƒè‡“éƒ¨ã€‘èƒŒæ™¯ã ã‘ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã®æœ€é«˜ç”»è³ªã‚¨ãƒ³ã‚¸ãƒ³ã§è‡ªä½œã™ã‚‹
        const finalCanvas = document.createElement('canvas');
        finalCanvas.width = contentCanvas.width;
        finalCanvas.height = contentCanvas.height;
        const ctx = finalCanvas.getContext('2d');

        // Canvasã®ãƒã‚¤ãƒ†ã‚£ãƒ–æ©Ÿèƒ½ã§ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»ï¼ˆã“ã‚ŒãŒç‰©ç†çš„ã«æœ€ã‚‚æ»‘ã‚‰ã‹ã§ã™ï¼‰
        const grad = ctx.createLinearGradient(0, 0, finalCanvas.width, finalCanvas.height);
        grad.addColorStop(0, selectedThemeColor);
        grad.addColorStop(1, adjustColor(selectedThemeColor, -30));
        
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);

        // 4. åˆä½“ï¼šæœ€é«˜ç”»è³ªã®èƒŒæ™¯ã®ä¸Šã«ã€æ–‡å­—ã‚’é‡ã­ã‚‹
        ctx.drawImage(contentCanvas, 0, 0);

        // 5. å¾Œå§‹æœ«ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»é¢ã‚’å…ƒã®ãƒ‡ã‚¶ã‚¤ãƒ³ã«æˆ»ã™
        card.style.background = originalBg;
        card.style.transform = originalTransform;
        bestEntries.forEach((entry, i) => {
            entry.style.backdropFilter = originalStyles[i].backdrop;
            entry.style.webkitBackdropFilter = originalStyles[i].webkitBackdrop;
            entry.style.background = originalStyles[i].bg;
        });

        // 6. ä¿å­˜ãƒ»å…±æœ‰å‡¦ç†ï¼ˆæœ€é«˜ç”»è³ªã®ã¾ã¾å‡ºåŠ›ï¼‰
        finalCanvas.toBlob(async (blob) => {
            if (!blob) { alert("ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚"); return; }
            const file = new File([blob], "LIVE_REPORT.png", { type: "image/png" });

            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                try {
                    await navigator.share({ files: [file], title: 'LIVE REPORT' });
                } catch (err) {
                    if (err.name !== 'AbortError') console.error("å…±æœ‰å¤±æ•—:", err);
                }
            } else {
                const link = document.createElement('a');
                const dateStr = new Date().toISOString().slice(0,10).replace(/-/g, '');
                link.download = `LIVE_REPORT_${dateStr}.png`;
                link.href = finalCanvas.toDataURL("image/png", 1.0);
                link.click();
                alert("å…±æœ‰æ©Ÿèƒ½ãŒæœªå¯¾å¿œã®ãŸã‚ã€ä¿å­˜ã—ã¾ã—ãŸã€‚");
            }
        }, 'image/png', 1.0);

    } catch (e) {
        // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å¿…ãšã‚¹ã‚¿ã‚¤ãƒ«ã‚’æˆ»ã™
        card.style.background = originalBg;
        card.style.transform = originalTransform;
        console.error("ç”Ÿæˆã‚¨ãƒ©ãƒ¼:", e);
        alert("ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
}

// ğŸŒŸè¿½åŠ ï¼šXæŠ•ç¨¿ç”¨é–¢æ•°
function shareOnX() {
    // çµ±è¨ˆç”»é¢ã®åˆè¨ˆè¡¨ç¤ºã‹ã‚‰æ•°å€¤ã‚’å–å¾—
    const statsTotal = document.getElementById('total-count-display').innerText;
    const text = `LIVE DIARY ğŸŠ ã§ãƒ©ã‚¤ãƒ–å‚æˆ¦ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼\nåˆè¨ˆå‚æˆ¦æ•°ã¯ ${statsTotal} å…¬æ¼”ï¼\n\n#LIVEDIARY #æ¨ã—æ´»\n`;
    
    // ã‚¢ãƒ—ãƒªã®URL
    const appUrl = "https://livediary-app.com/"; 
    
    // Xã®ã‚·ã‚§ã‚¢ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆURLã‚’ä½œæˆ
    const xUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(appUrl)}`;
    
    // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã
    window.open(xUrl, '_blank');
}


// --- ã‚·ã‚§ã‚¢ãƒ¬ãƒãƒ¼ãƒˆç”¨ï¼šã“ã“ã¾ã§ ---

        function deleteArtist(n) { if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')){ db.artists=db.artists.filter(a=>a!==n); db.lives=db.lives.filter(l=>l.artist!==n); save(); renderArtistManager(); } }
        function exportData() { const blob = new Blob([JSON.stringify(db)], {type:'application/json'}); const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='livelog.json'; a.click(); }
        function importData(e) { 
    const f = e.target.files[0]; 
    if (!f) return;
    
    // 1. ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¾Œã®ç¢ºèªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
    if (!confirm('ãƒªã‚¹ãƒˆã‚¢ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
        e.target.value = ''; // é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
        return;
    }

    const r = new FileReader(); 
    r.onload = (ev) => { 
        try {
            db = JSON.parse(ev.target.result); 
            save(); 
            
            // 2. å®Œäº†å¾Œã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
            alert('ãƒªã‚¹ãƒˆã‚¢ã—ã¾ã—ãŸ');
            
            location.reload(); 
        } catch(err) {
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
        }
    }; 
    r.readAsText(f); 
}

// è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
// è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
function openTermsModal(type) {
    const titleEl = document.getElementById('terms-modal-title');
    const bodyEl = document.getElementById('terms-modal-body');

    if (type === 'terms') {
        titleEl.innerText = "åˆ©ç”¨è¦ç´„";
        bodyEl.innerHTML = `
            <p><strong>ç¬¬1æ¡ï¼ˆç›®çš„ï¼‰</strong><br>æœ¬è¦ç´„ã¯ã€LIVE DIARY ğŸŠï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚¢ãƒ—ãƒªã€ã¨ã„ã„ã¾ã™ï¼‰ã®åˆ©ç”¨æ¡ä»¶ã‚’å®šã‚ã‚‹ã‚‚ã®ã§ã™ã€‚æœ¬ã‚¢ãƒ—ãƒªã‚’åˆ©ç”¨ã™ã‚‹ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆä»¥ä¸‹ã€Œåˆ©ç”¨è€…ã€ã¨ã„ã„ã¾ã™ï¼‰ã¯ã€æœ¬è¦ç´„ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚</p>
            <p><strong>ç¬¬2æ¡ï¼ˆéå…¬å¼æ€§ï¼‰</strong><br>æœ¬ã‚¢ãƒ—ãƒªã¯ã€å€‹äººãŒåˆ¶ä½œã—ãŸéå…¬å¼ã®ãƒ•ã‚¡ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€ç‰¹å®šã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€æ‰€å±äº‹å‹™æ‰€ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ä¼šç¤¾ã€åŠã³å…¬å¼ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–ç­‰ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <p><strong>ç¬¬3æ¡ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ã¨è²¬ä»»ï¼‰</strong><br>1. æœ¬ã‚¢ãƒ—ãƒªã«å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ã€åˆ©ç”¨è€…ã®ç«¯æœ«å†…ï¼ˆLocalStorageï¼‰ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚é–‹ç™ºè€…ãŒã‚µãƒ¼ãƒãƒ¼ç­‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ç®¡ç†ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>2. åˆ©ç”¨è€…ã¯ã€è‡ªã‚‰ã®è²¬ä»»ã«ãŠã„ã¦ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ãŠã‚ˆã³ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’è¡Œã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¶ˆå»ã€ç«¯æœ«ã®ç´›å¤±ã€æ©Ÿç¨®å¤‰æ›´ç­‰ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±ã«ã¤ã„ã¦ã€é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</p>
            <p><strong>ç¬¬4æ¡ï¼ˆç¦æ­¢äº‹é …ï¼‰</strong><br>åˆ©ç”¨è€…ã¯ã€ä»¥ä¸‹ã®è¡Œç‚ºã‚’è¡Œã£ã¦ã¯ãªã‚‰ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚<br>
            1. æœ¬ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆHTML/CSS/JSï¼‰ã®å…¨éƒ¨ã¾ãŸã¯ä¸€éƒ¨ã‚’ã€æ”¹å¤‰ã®æœ‰ç„¡ã‚’å•ã‚ãšã€ç¬¬ä¸‰è€…ã«å†é…å¸ƒã€è»¢è¼‰ã€ã¾ãŸã¯è²©å£²ã™ã‚‹è¡Œç‚ºã€‚<br>
            2. æœ¬ã‚¢ãƒ—ãƒªã‚’å…¬å¼ã‚¢ãƒ—ãƒªã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«èª¤èªã•ã›ã‚‹è¡Œç‚ºã€‚<br>
            3. é–‹ç™ºè€…ã¾ãŸã¯ç¬¬ä¸‰è€…ã®è‘—ä½œæ¨©ã€åèª‰ã€ä¿¡ç”¨ã‚’æ¯€æã™ã‚‹è¡Œç‚ºã€‚<br>
            4. æœ¬ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã€ã¾ãŸã¯è§£æã™ã‚‹è¡Œç‚ºã€‚<br>
            5. æ³•ä»¤ã¾ãŸã¯å…¬åºè‰¯ä¿—ã«åã™ã‚‹è¡Œç‚ºã€‚</p>
            <p><strong>ç¬¬5æ¡ï¼ˆè‘—ä½œæ¨©ãŠã‚ˆã³çŸ¥çš„è²¡ç”£æ¨©ï¼‰</strong><br>1. æœ¬ã‚¢ãƒ—ãƒªå†…ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã€æ¥½æ›²åç­‰ã«é–¢ã™ã‚‹çŸ¥çš„è²¡ç”£æ¨©ã¯ã€å„æ¨©åˆ©è€…ã«å¸°å±ã—ã¾ã™ã€‚<br>2. æœ¬ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ç‹¬è‡ªã®ãƒ‡ã‚¶ã‚¤ãƒ³ã€åŠã³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®è‘—ä½œæ¨©ã¯ã€é–‹ç™ºè€…ã«å¸°å±ã—ã¾ã™ã€‚</p>
            <p><strong>ç¬¬6æ¡ï¼ˆå…è²¬äº‹é …ï¼‰</strong><br>1. æœ¬ã‚¢ãƒ—ãƒªã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸç›´æ¥çš„ã¾ãŸã¯é–“æ¥çš„ãªæå®³ã«ã¤ã„ã¦ã€é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚<br>2. æœ¬ã‚¢ãƒ—ãƒªå†…ã®å¤–éƒ¨ãƒªãƒ³ã‚¯å…ˆï¼ˆæ¥½å¤©ã€Apple Musicã€Spotifyç­‰ï¼‰ã§æä¾›ã•ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚„å•†å“ã«é–¢ã™ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã«ã¤ã„ã¦ã€é–‹ç™ºè€…ã¯ä¸€åˆ‡é–¢ä¸ã„ãŸã—ã¾ã›ã‚“ã€‚<br>3. æœ¬ã‚¢ãƒ—ãƒªã¯ã€äºˆå‘Šãªãã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã‚’ä¸­æ–­ã€å¤‰æ›´ã€ã¾ãŸã¯çµ‚äº†ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>4. é–‹ç™ºè€…ã¯ã€æœ¬ã‚¢ãƒ—ãƒªã«é–¢ã™ã‚‹å•ã„åˆã‚ã›ã«å¯¾ã—ã€å›ç­”ã¾ãŸã¯å¯¾å¿œã™ã‚‹ç¾©å‹™ã‚’è² ã‚ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
            <p><strong>ç¬¬7æ¡ï¼ˆè¦ç´„ã®å¤‰æ›´ï¼‰</strong><br>é–‹ç™ºè€…ã¯ã€å¿…è¦ã¨åˆ¤æ–­ã—ãŸå ´åˆã«ã¯ã€åˆ©ç”¨è€…ã«é€šçŸ¥ã™ã‚‹ã“ã¨ãªãæœ¬è¦ç´„ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
            <hr style="border: none; border-top: 1px solid #f2f2f7; margin: 20px 0;">
            <p style="color: #8e8e93; text-align: right; font-size: 0.8rem;">2026å¹´2æœˆ10æ—¥ åˆ¶å®š</p>
        `;
    } else if (type === 'privacy') {
        titleEl.innerText = "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼";
        bodyEl.innerHTML = `
            <p><strong>å€‹äººæƒ…å ±ã®åé›†ã«ã¤ã„ã¦</strong><br>æœ¬ã‚¢ãƒ—ãƒªã¯ã€æ°åã‚„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ã®å€‹äººæƒ…å ±ã‚’åé›†ãƒ»é€ä¿¡ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å…¥åŠ›ã•ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ã¯ã™ã¹ã¦ãŠå®¢æ§˜ã®ç«¯æœ«å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            <p><strong>ã‚¢ã‚¯ã‚»ã‚¹è§£æãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</strong><br>æœ¬ã‚¢ãƒ—ãƒªã§ã¯ã€åˆ©ç”¨çŠ¶æ³ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã«Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã‚¯ãƒƒã‚­ãƒ¼ï¼ˆCookieï¼‰ã‚’é€šã˜ã¦åŒ¿åã§ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€å€‹äººã‚’ç‰¹å®šã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            <p><strong>åºƒå‘Šãƒ»ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã«ã¤ã„ã¦</strong><br>æœ¬ã‚¢ãƒ—ãƒªã§ã¯ã€æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒªãƒ³ã‚¯å…ˆã§ã®è³¼å…¥ã«é–¢ã™ã‚‹ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã«ã¤ã„ã¦ã¯ã€å„ææºå…ˆã®ãƒãƒªã‚·ãƒ¼ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
            <p><strong>æ³•ä»¤ã®éµå®ˆ</strong><br>é–‹ç™ºè€…ã¯ã€æ—¥æœ¬å›½ã®æ³•ä»¤ã‚’éµå®ˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã«åŠªã‚ã¾ã™ã€‚</p>
            <hr style="border: none; border-top: 1px solid #f2f2f7; margin: 20px 0;">
            <p style="color: #8e8e93; text-align: right; font-size: 0.8rem;">2026å¹´2æœˆ10æ—¥ åˆ¶å®š</p>
        `;
    }

    // èƒŒé¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ã«ã™ã‚‹ï¼ˆæ¨å¥¨è¿½åŠ ï¼‰
    document.body.style.overflow = 'hidden';
    document.getElementById('terms-modal').classList.remove('hidden');
}

// è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closeTermsModal() {
    // èƒŒé¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ã‚’è§£é™¤ã™ã‚‹ï¼ˆæ¨å¥¨è¿½åŠ ï¼‰
    document.body.style.overflow = '';
    document.getElementById('terms-modal').classList.add('hidden');
}


    </script>
    
    <div id="terms-modal" class="modal-overlay hidden" onclick="closeTermsModal()">
    <div class="modal-content" onclick="event.stopPropagation()" style="max-height: 80vh; display: flex; flex-direction: column; width: 90%; max-width: 400px; margin: auto; border-radius: 15px; overflow: hidden;">
        
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #f2f2f7; background: #fff;">
            <div style="width: 24px;"></div> <h3 id="terms-modal-title" style="margin:0; font-size:1rem; text-align: center; flex-grow: 1; font-weight: bold;">è¦ç´„</h3>
            <button onclick="closeTermsModal()" class="close-btn" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0; width: 24px; color: #8e8e93;">âœ•</button>
        </div>

        <div class="modal-body" id="terms-modal-body" style="overflow-y: auto; text-align: left; font-size: 0.85rem; line-height: 1.7; color: #444; padding: 20px 20px 40px 20px; background: #fff;">
            </div>
    </div>
</div>

    
</body>
</html>
